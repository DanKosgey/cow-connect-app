import{r as c,c as M,j as e}from"./index-C6fZJ48e.js";import{C as K,a as Y,b as U,c as A,d as $}from"./card-D80GW863.js";import{B as x}from"./button-CjSaidot.js";import{I as C}from"./input-ZoKW3yZy.js";import{L as v}from"./label-Cb1HMnpx.js";import{S as G,a as H,b as W,c as J,d as P}from"./select-CiyqlXTk.js";import{A as _,a as F}from"./alert-Civ_HrAB.js";import{P as X}from"./progress-J4JJxqa_.js";import{C as z}from"./circle-check-big-CorUa3eH.js";import{F as Z}from"./file-text-BWfQSXbE.js";import{U as V}from"./upload-BOOwyOZq.js";import{C as T}from"./circle-alert-B7BDXU-i.js";import{C as Q}from"./camera-CKo63GeG.js";import{L as ee}from"./loader-circle-tNDcm6lY.js";import"./index-BdQq_4o_.js";import"./index-Bmq6tP-i.js";import"./Combination-D2BFsl2-.js";import"./index-wh3HXzvH.js";import"./check-wjAQzcvr.js";class ae{async uploadDocuments(l,s){const t=new FormData;t.append("document_type",s.document_type),t.append("document_number",s.document_number),t.append("expiry_date",s.expiry_date),t.append("front_image",s.front_image),s.back_image&&t.append("back_image",s.back_image),t.append("selfie_image",s.selfie_image);try{const o=localStorage.getItem("authToken"),m=await fetch(`/api/v1/farmers/${l}/kyc`,{method:"POST",headers:{...o?{Authorization:`Bearer ${o}`}:{}},body:t});if(!m.ok)throw new Error(`API ${m.status}: ${m.statusText}`);return await m.json()}catch(o){throw console.error("KYC upload failed:",o),new Error("Failed to upload KYC documents. Please try again.")}}async getKYCStatus(l){try{const s=localStorage.getItem("authToken"),t=await fetch(`/api/v1/farmers/${l}/kyc`,{method:"GET",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}}});if(!t.ok)throw new Error(`API ${t.status}: ${t.statusText}`);return await t.json()}catch(s){throw console.error("Failed to fetch KYC status:",s),new Error("Failed to fetch KYC status. Please try again.")}}async updateDocuments(l,s){const t=new FormData;t.append("document_type",s.document_type),t.append("document_number",s.document_number),t.append("expiry_date",s.expiry_date),t.append("front_image",s.front_image),s.back_image&&t.append("back_image",s.back_image),t.append("selfie_image",s.selfie_image);try{const o=localStorage.getItem("authToken"),m=await fetch(`/api/v1/farmers/${l}/kyc`,{method:"PUT",headers:{...o?{Authorization:`Bearer ${o}`}:{}},body:t});if(!m.ok)throw new Error(`API ${m.status}: ${m.statusText}`);return await m.json()}catch(o){throw console.error("KYC update failed:",o),new Error("Failed to update KYC documents. Please try again.")}}}const E=new ae,te=()=>{const[y,l]=c.useState(!1),[s,t]=c.useState(0),[o,m]=c.useState(null),[k,g]=c.useState(null),n=c.useCallback(async(i,d)=>{l(!0),g(null),t(0);try{const u=setInterval(()=>{t(b=>Math.min(b+10,90))},200),h=await E.uploadDocuments(i,d);return clearInterval(u),t(100),setTimeout(()=>{l(!1),m(h)},500),h}catch(u){throw l(!1),g(u instanceof Error?u.message:"Failed to upload documents"),u}},[]),f=c.useCallback(async i=>{try{const d=await E.getKYCStatus(i);return m(d),d}catch(d){throw g(d instanceof Error?d.message:"Failed to fetch KYC status"),d}},[]),j=c.useCallback(async(i,d)=>{l(!0),g(null),t(0);try{const u=setInterval(()=>{t(b=>Math.min(b+10,90))},200),h=await E.updateDocuments(i,d);return clearInterval(u),t(100),setTimeout(()=>{l(!1),m(h)},500),h}catch(u){throw l(!1),g(u instanceof Error?u.message:"Failed to update documents"),u}},[]),N=c.useCallback(()=>{l(!1),t(0),m(null),g(null)},[]);return{isUploading:y,uploadProgress:s,kycStatus:o,error:k,uploadDocuments:n,getKYCStatus:f,updateDocuments:j,reset:N}},se=5*1024*1024,re=["image/jpeg","image/png","image/webp"],ne=({farmerId:y="default-farmer-id"})=>{const{toast:l}=M(),{isUploading:s,uploadProgress:t,kycStatus:o,error:m,uploadDocuments:k,reset:g}=te(),[n,f]=c.useState({documentType:"national_id",documentNumber:"",expiryDate:null,frontImage:null,backImage:null,selfieImage:null}),[j,N]=c.useState({frontImagePreview:null,backImagePreview:null,selfieImagePreview:null}),[i,d]=c.useState({}),u=c.useRef(null),h=c.useRef(null),b=c.useRef(null),L=r=>r.size>se?"File size exceeds 5MB limit":re.includes(r.type)?null:"Invalid file format. Please upload JPEG, PNG, or WebP images",S=c.useCallback((r,a)=>{if(!a){f(p=>({...p,[r]:null})),N(p=>({...p,[`${r}Preview`]:null}));return}const D=L(a);if(D){d(p=>({...p,[r]:D}));return}d(p=>{const B={...p};return delete B[r],B}),f(p=>({...p,[r]:a}));const I=new FileReader;I.onloadend=()=>{N(p=>({...p,[`${r}Preview`]:I.result}))},I.readAsDataURL(a)},[]),O=r=>{f(a=>({...a,documentType:r,backImage:r==="passport"?null:a.backImage})),r==="passport"&&N(a=>({...a,backImagePreview:null}))},q=async r=>{var I;r.preventDefault();const a={};if(n.documentNumber.trim()||(a.documentNumber="Document number is required"),n.expiryDate?n.expiryDate<new Date&&(a.expiryDate="Document cannot be expired"):a.expiryDate="Expiry date is required",n.frontImage||(a.frontImage="Front image is required"),n.documentType!=="passport"&&!n.backImage&&(a.backImage="Back image is required"),n.selfieImage||(a.selfieImage="Selfie image is required"),Object.keys(a).length>0){d(a),l({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});return}const D={document_type:n.documentType,document_number:n.documentNumber,expiry_date:((I=n.expiryDate)==null?void 0:I.toISOString().split("T")[0])||"",front_image:n.frontImage,back_image:n.documentType!=="passport"&&n.backImage||void 0,selfie_image:n.selfieImage};try{await k(y,D),l({title:"Success",description:"KYC documents uploaded successfully"})}catch{l({title:"Upload Failed",description:m||"Failed to upload documents. Please try again.",variant:"destructive"})}},R=()=>{f({documentType:"national_id",documentNumber:"",expiryDate:null,frontImage:null,backImage:null,selfieImage:null}),N({frontImagePreview:null,backImagePreview:null,selfieImagePreview:null}),d({}),g()},w=r=>{var a;(a=r.current)==null||a.click()};return o&&o.status!=="pending"?e.jsxs(K,{className:"w-full max-w-2xl mx-auto",children:[e.jsxs(Y,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-6 w-6 text-green-500"}),"KYC Submission Successful"]}),e.jsx(A,{children:"Your documents have been uploaded and are pending review."})]}),e.jsx($,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{className:"h-8 w-8 text-green-500"})}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Thank you for submitting your documents"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"We'll review your KYC information and notify you of the status within 24-48 hours."}),e.jsx(x,{onClick:R,children:"Submit Another Document"})]})})]}):e.jsxs(K,{className:"w-full max-w-2xl mx-auto",children:[e.jsxs(Y,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"KYC Document Upload"]}),e.jsx(A,{children:"Please upload clear images of your identification documents"})]}),e.jsx($,{children:e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"documentType",children:"Document Type"}),e.jsxs(G,{value:n.documentType,onValueChange:O,children:[e.jsx(H,{children:e.jsx(W,{placeholder:"Select document type"})}),e.jsxs(J,{children:[e.jsx(P,{value:"national_id",children:"National ID"}),e.jsx(P,{value:"passport",children:"Passport"}),e.jsx(P,{value:"drivers_license",children:"Driver's License"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"documentNumber",children:"Document Number"}),e.jsx(C,{id:"documentNumber",value:n.documentNumber,onChange:r=>f(a=>({...a,documentNumber:r.target.value})),placeholder:"Enter document number",className:i.documentNumber?"border-red-500":""}),i.documentNumber&&e.jsx("p",{className:"text-sm text-red-500",children:i.documentNumber})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"expiryDate",children:"Expiry Date"}),e.jsx(C,{id:"expiryDate",type:"date",value:n.expiryDate?n.expiryDate.toISOString().split("T")[0]:"",onChange:r=>f(a=>({...a,expiryDate:r.target.value?new Date(r.target.value):null})),className:i.expiryDate?"border-red-500":""}),i.expiryDate&&e.jsx("p",{className:"text-sm text-red-500",children:i.expiryDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Front of Document"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[e.jsx(C,{type:"file",ref:u,className:"hidden",accept:"image/jpeg,image/png,image/webp",onChange:r=>{var a;return S("frontImage",((a=r.target.files)==null?void 0:a[0])||null)}}),j.frontImagePreview?e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:j.frontImagePreview,alt:"Front document preview",className:"max-h-48 mx-auto rounded-lg",loading:"lazy"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>w(u),children:"Change Image"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Upload front of document"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Click to browse or drag and drop"})]}),e.jsx(x,{type:"button",onClick:()=>w(u),children:"Select File"})]})]}),i.frontImage&&e.jsxs(_,{variant:"destructive",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(F,{children:i.frontImage})]})]}),n.documentType!=="passport"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Back of Document"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[e.jsx(C,{type:"file",ref:h,className:"hidden",accept:"image/jpeg,image/png,image/webp",onChange:r=>{var a;return S("backImage",((a=r.target.files)==null?void 0:a[0])||null)}}),j.backImagePreview?e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:j.backImagePreview,alt:"Back document preview",className:"max-h-48 mx-auto rounded-lg",loading:"lazy"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>w(h),children:"Change Image"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Upload back of document"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Click to browse or drag and drop"})]}),e.jsx(x,{type:"button",onClick:()=>w(h),children:"Select File"})]})]}),i.backImage&&e.jsxs(_,{variant:"destructive",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(F,{children:i.backImage})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Selfie with Document"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[e.jsx(C,{type:"file",ref:b,className:"hidden",accept:"image/jpeg,image/png,image/webp",onChange:r=>{var a;return S("selfieImage",((a=r.target.files)==null?void 0:a[0])||null)}}),j.selfieImagePreview?e.jsxs("div",{className:"space-y-4",children:[e.jsx("img",{src:j.selfieImagePreview,alt:"Selfie preview",className:"max-h-48 mx-auto rounded-lg",loading:"lazy"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>w(b),children:"Change Image"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{className:"h-12 w-12 text-gray-400 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Upload selfie with document"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hold document next to your face"})]}),e.jsx(x,{type:"button",onClick:()=>w(b),children:"Take Photo"})]})]}),i.selfieImage&&e.jsxs(_,{variant:"destructive",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(F,{children:i.selfieImage})]})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Uploading documents..."}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t,"%"]})]}),e.jsx(X,{value:t,className:"w-full"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{type:"submit",className:"flex-1",disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):"Submit for Verification"}),e.jsx(x,{type:"button",variant:"outline",onClick:R,disabled:s,children:"Reset"})]})]})})]})},Ce=()=>{const[y,l]=c.useState("farmer-123"),[s,t]=c.useState(!1);return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Farmer Verification"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Please complete your KYC verification to access all features"})]}),e.jsxs(K,{className:"mb-8",children:[e.jsxs(Y,{children:[e.jsx(U,{children:"Farmer Information"}),e.jsx(A,{children:"Enter your farmer ID to begin verification"})]}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"farmerId",children:"Farmer ID"}),e.jsx(C,{id:"farmerId",value:y,onChange:o=>l(o.target.value),placeholder:"Enter your farmer ID"})]}),e.jsx(x,{onClick:()=>t(!0),children:"Start KYC Verification"})]})]}),s&&e.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden mb-12",children:e.jsx(ne,{farmerId:y})}),e.jsxs("div",{className:"mt-12 bg-blue-50 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"KYC Verification Process"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-blue-600 font-bold text-lg mb-2",children:"1"}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Upload Documents"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Provide clear images of your ID and a selfie holding the document"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-blue-600 font-bold text-lg mb-2",children:"2"}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Verification"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Our team will review your documents within 24-48 hours"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-blue-600 font-bold text-lg mb-2",children:"3"}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"Approval"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Once approved, you'll gain full access to all platform features"})]})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Need Help?"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"If you have any questions about the KYC process, please contact our support team."}),e.jsx(x,{variant:"outline",children:"Contact Support"})]})]})})};export{Ce as default};
