import{e as Y,r as o,a as A,j as e,d as te,B as ne,E as ae,z as T,M as le,U as K,L as oe,u as ce}from"./index-C6fZJ48e.js";import{C as de,R as _,a as $}from"./ApiService-bGFnA_mg.js";import{C as u,a as X,b as J,d as ee}from"./card-D80GW863.js";import{B as p}from"./button-CjSaidot.js";import{T as me,a as xe,b as W,c as q}from"./tabs-BM6-MBQ3.js";import{B as he}from"./badge-Bb0m1QXe.js";import{e as ue,C as ge,a as pe,L as fe,P as be,f as je,p as Ne,c as ye,d as ve,i as we}from"./index-BYOAP1dX.js";import{V as k}from"./VisuallyHidden-DcEPUErl.js";import{I as V}from"./input-ZoKW3yZy.js";import{L as E}from"./label-Cb1HMnpx.js";import{S as Se,a as Ce,b as ke,c as Me,d as O}from"./select-CiyqlXTk.js";import{b as Le,c as De,d as Re,e as Te,f as _e,g as Ee,h as Ae,i as Fe,j as Ie,k as Pe,A as Ge,l as Be,L as We}from"./avatar-BmR-I4hu.js";import{H as qe,c as Ve}from"./sheet-hMc6SWc2.js";import{A as $e}from"./award-DYlhwJpD.js";import{M as ze}from"./message-square-CDlA2FQl.js";import{C as Ue}from"./circle-help-Dc1FX5Pa.js";import{M as se}from"./map-pin-B94T8gzc.js";import{U as He}from"./upload-BOOwyOZq.js";import"./index-7U90ZyfE.js";import"./index-Bmq6tP-i.js";import"./index-BdQq_4o_.js";import"./Combination-D2BFsl2-.js";import"./index-wh3HXzvH.js";import"./check-wjAQzcvr.js";import"./separator-DKBG6nYm.js";import"./index-CrhFojRB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=Y("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=Y("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=Y("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),Ze=async(s,t)=>{try{const c=await de.sendMessage(s,`Staff support for user ${t}`);return{from_user:"assistant",text:c.response,timestamp:c.timestamp}}catch(c){throw console.error("Chat API error:",c),c}};function Ke(){const[s,t]=o.useState(!1),[c,a]=o.useState([{from_user:"system",text:"Welcome to Staff Support! How can we help?"}]),[x,l]=o.useState(""),{user:b}=A(),j=async()=>{if(!x.trim()||!b)return;const r={from_user:"user",text:x};a(m=>[...m,r]),l("");try{const m=await Ze(x,b.id);a(d=>[...d,m])}catch{a(d=>[...d,{from_user:"system",text:"Failed to send message. Please try again."}])}};return e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:s?e.jsxs("div",{className:"w-80 bg-white rounded-xl shadow-lg border p-4 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-bold text-emerald-700",children:"Staff Chat"}),e.jsx("button",{onClick:()=>t(!1),className:"text-gray-400 hover:text-red-500",children:"âœ•"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-2 max-h-60",children:c.map((r,m)=>e.jsx("div",{className:`mb-2 ${r.from_user==="user"?"text-right":""}`,children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-lg ${r.from_user==="user"?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-700"}`,children:r.text})},m))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 border rounded px-2 py-1",value:x,onChange:r=>l(r.target.value),placeholder:"Type a message...",onKeyDown:r=>r.key==="Enter"&&j()}),e.jsx("button",{className:"bg-emerald-600 text-white px-3 py-1 rounded",onClick:j,children:"Send"})]})]}):e.jsx("button",{className:"bg-emerald-600 text-white px-4 py-2 rounded-full shadow-lg",onClick:()=>t(!0),children:"ðŸ’¬ Staff Chat"})})}const Xe=()=>{const{user:s}=A(),[t,c]=o.useState([]),[a,x]=o.useState(null),[l,b]=o.useState([]),[j,r]=o.useState(!0),[m,d]=o.useState(null),[R,w]=o.useState(!1),[N,S]=o.useState("list");o.useEffect(()=>{s&&y()},[s]);const y=async()=>{var i;try{if(r(!0),!s)return;const g=new Date().toISOString().split("T")[0],v=await _.generateDailyRoute(s.id,g);x(v.route),b(((i=v.navigation_data)==null?void 0:i.stops)||[]);const D=await _.getStaffRouteHistory(s.id,7);c(D),r(!1)}catch(g){console.error("Error fetching route:",g),d("Failed to load route information"),r(!1)}},M=async()=>{try{if(!a||!s)return;await _.startRouteExecution(a.id,s.id),w(!0),x({...a,status:"in_progress"})}catch(i){console.error("Error starting route:",i),d("Failed to start route")}},L=async()=>{try{if(!a||!s)return;await _.completeRouteExecution(a.id,s.id),w(!1),x({...a,status:"completed"}),y()}catch(i){console.error("Error completing route:",i),d("Failed to complete route")}},C=async()=>{try{if(!a||!s)return;navigator.geolocation?navigator.geolocation.getCurrentPosition(async i=>{const{latitude:g,longitude:v}=i.coords;await _.recordGPSTrackPoint(a.id,s.id,{latitude:g,longitude:v}),w(!0)},i=>{console.error("Error getting location:",i),d("Failed to get current location")}):d("Geolocation is not supported by this browser")}catch(i){console.error("Error tracking location:",i),d("Failed to track location")}},F=()=>{if(l.length===0)return null;const i=l.map(h=>h.location.latitude),g=l.map(h=>h.location.longitude),v=Math.min(...i),D=Math.max(...i),I=Math.min(...g),P=Math.max(...g),n=(D-v)*.1,f=(P-I)*.1,G=v-n,re=D+n,Z=I-f,ie=P+f,z=600,B=400,U=h=>B-(h-G)/(re-G)*B,H=h=>(h-Z)/(ie-Z)*z;return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold",children:"Route Map"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[l.length," stops â€¢ ",a==null?void 0:a.estimated_distance," km"]})]}),e.jsxs("div",{className:"border rounded-lg p-2 bg-gray-50",children:[e.jsxs("svg",{width:z,height:B,viewBox:`0 0 ${z} ${B}`,className:"w-full",children:[l.length>1&&e.jsx("polyline",{points:l.map(h=>`${H(h.location.longitude)},${U(h.location.latitude)}`).join(" "),fill:"none",stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"5,5"}),l.map((h,Q)=>e.jsxs("g",{children:[e.jsx("circle",{cx:H(h.location.longitude),cy:U(h.location.latitude),r:"8",fill:Q===0?"#10b981":Q===l.length-1?"#ef4444":"#3b82f6",stroke:"white",strokeWidth:"2"}),e.jsx("text",{x:H(h.location.longitude),y:U(h.location.latitude)-15,textAnchor:"middle",fontSize:"12",fill:"#374151",children:Q+1})]},h.farmer_id))]}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:"Start"}),e.jsx("span",{children:"End"})]})]})]})};return j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{children:[e.jsx(X,{children:e.jsx(J,{children:"Today's Route"})}),e.jsxs(ee,{children:[m&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:m}),a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Route Date"}),e.jsx("p",{children:new Date(a.route_date).toLocaleDateString()})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-800",children:"Estimated Duration"}),e.jsxs("p",{children:[a.estimated_duration," minutes"]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-800",children:"Estimated Distance"}),e.jsxs("p",{children:[a.estimated_distance," km"]})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-yellow-800",children:"Status"}),e.jsx("p",{className:"capitalize",children:a.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsx("button",{className:`px-4 py-2 font-medium ${N==="list"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>S("list"),children:"Stop List"}),e.jsx("button",{className:`px-4 py-2 font-medium ${N==="map"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>S("map"),children:"Route Map"})]}),N==="list"?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Planned Stops (",a.planned_stops.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:l.length>0?l.map((i,g)=>e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg border",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center bg-blue-100 text-blue-800 rounded-full mr-3",children:g+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.location.latitude.toFixed(6),", ",i.location.longitude.toFixed(6)]})]})]},i.farmer_id)):e.jsx("p",{className:"text-gray-500",children:"No stop details available"})})]}):F(),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.status==="assigned"&&e.jsx(p,{onClick:M,className:"bg-green-600 hover:bg-green-700",children:"Start Route"}),a.status==="in_progress"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{onClick:C,className:"bg-blue-600 hover:bg-blue-700",children:"Track Location"}),e.jsx(p,{onClick:L,className:"bg-purple-600 hover:bg-purple-700",children:"Complete Route"})]}),a.status==="completed"&&e.jsx(p,{disabled:!0,className:"bg-gray-400",children:"Route Completed"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No route assigned for today"}),e.jsx(p,{onClick:y,children:"Generate Route"})]})]})]}),e.jsxs(u,{children:[e.jsx(X,{children:e.jsx(J,{children:"Recent Routes"})}),e.jsx(ee,{children:t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(i=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:new Date(i.route_date).toLocaleDateString()}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.planned_stops.length," stops â€¢ ",i.estimated_duration," min"]})]}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded text-sm capitalize",children:i.status.replace("_"," ")})]},i.id))}):e.jsx("p",{className:"text-gray-500",children:"No recent routes found"})})]})]})};ge.register(pe,fe,be,je,Ne,ye,ve,we);const Je=({data:s,labels:t,title:c})=>{const a={labels:t,datasets:[{label:c||"Performance",data:s,borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.5)",tension:.4,fill:!0}]},x={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!!c,text:c||""}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}},x:{grid:{display:!1}}}};return e.jsx("div",{className:"w-full h-full",children:e.jsx(ue,{data:a,options:x})})},es={daily:[65,75,82,78,89,92,95]},ss=()=>{const{user:s}=A(),[t,c]=o.useState([]),[a,x]=o.useState(!0),[l,b]=o.useState({today:0,thisWeek:0,thisMonth:0,totalLiters:0});o.useEffect(()=>{(async()=>{if(s)try{const m=await $.Collections.list(5,0,void 0,s.id);c(m.items);const d=new Date,R=new Date(d);R.setDate(d.getDate()-d.getDay());const w=new Date(d.getFullYear(),d.getMonth(),1);let N=0,S=0,y=0,M=0;m.items.forEach(L=>{const C=new Date(L.timestamp);C.toDateString()===d.toDateString()&&N++,C>=R&&S++,C>=w&&y++,M+=L.liters}),b({today:N,thisWeek:S,thisMonth:y,totalLiters:M})}catch(m){console.error("Error fetching collections:",m)}finally{x(!1)}})()},[s]);const j=r=>{switch(r){case"A":return"bg-green-100 text-green-800";case"B":return"bg-yellow-100 text-yellow-800";case"C":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(te,{targetId:"main-content",children:"Skip to main content"}),e.jsxs("main",{id:"main-content",role:"main",children:[e.jsxs("section",{"aria-labelledby":"stats-heading",children:[e.jsx(k,{as:"h2",id:"stats-heading",children:"Dashboard Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Today's Collections"}),e.jsx("div",{className:"text-4xl font-bold text-blue-600",children:l.today}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Collections recorded"})]}),e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"This Week"}),e.jsx("div",{className:"text-4xl font-bold text-primary-600",children:l.thisWeek}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Collections"})]}),e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"This Month"}),e.jsx("div",{className:"text-4xl font-bold text-purple-600",children:l.thisMonth}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Collections"})]}),e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Total Volume"}),e.jsxs("div",{className:"text-4xl font-bold text-orange-600",children:[l.totalLiters.toFixed(1),"L"]}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Milk collected"})]})]})]}),e.jsxs("section",{"aria-labelledby":"trends-heading",className:"mt-8",children:[e.jsx(k,{as:"h2",id:"trends-heading",children:"Collection Trends"}),e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Collection Trends"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(Je,{data:es.daily,labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]})})]})]}),e.jsxs("section",{"aria-labelledby":"activity-heading",className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-8",children:[e.jsx(k,{as:"h2",id:"activity-heading",children:"Activity"}),e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Recent Collections"}),e.jsx(p,{variant:"outline",size:"sm","aria-label":"View all collections",children:"View All"})]}),a?e.jsxs("div",{className:"text-center py-4 text-gray-500",role:"status",children:[e.jsx(k,{children:"Loading collections..."}),e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-600"})]}):t.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No collections recorded yet"}):e.jsx("div",{className:"space-y-4",children:t.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.farmer_name||"Unknown Farmer"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[new Date(r.timestamp).toLocaleDateString()," â€¢ ",r.liters,"L"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(he,{className:j(r.quality_grade),children:["Grade ",r.quality_grade]}),e.jsxs("span",{className:"text-sm font-medium",children:[r.liters,"L"]})]})]},r.id))})]}),e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Upcoming Rewards"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Quarterly Bonus"}),e.jsx("span",{className:"text-primary-600 font-semibold",children:"$1,500"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Performance Incentive"}),e.jsx("span",{className:"text-primary-600 font-semibold",children:"$800"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Training Completion Bonus"}),e.jsx("span",{className:"text-primary-600 font-semibold",children:"$500"})]})]})]})]})]})]})},ts=()=>{const{theme:s,setTheme:t}=ne(),c=()=>{t(s==="light"?"dark":"light")};return e.jsxs(p,{variant:"outline",size:"icon",onClick:c,className:"rounded-full",children:[s==="light"?e.jsx(Oe,{className:"h-4 w-4"}):e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})},as=[{title:"Dashboard",url:"/staff",icon:qe},{title:"Routes",url:"/staff/routes",icon:Qe},{title:"Collections",url:"/staff/collections",icon:le},{title:"Rewards",url:"/staff/rewards",icon:$e},{title:"Messages",url:"/staff/messages",icon:ze},{title:"Help & Support",url:"/staff/help",icon:Ue}];function ls(){const s=ae(),{user:t,logout:c}=A();o.useEffect(()=>(T.debug("StaffSidebar component mounted"),()=>{T.debug("StaffSidebar component unmounted")}),[]);const a=l=>{T.info("Navigation triggered",{path:l})},x=async()=>{try{await c(),T.info("User logged out successfully")}catch(l){T.error("Error during logout",l)}};return T.time("Sidebar Render"),e.jsxs(Le,{className:"border-r border-blue-200 bg-white/90 backdrop-blur-sm",children:[e.jsx(De,{className:"border-b border-blue-200 p-4 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(le,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent",children:"DairyChain Pro"}),e.jsxs("p",{className:"text-xs text-blue-600 flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),"Staff Portal"]})]})]})}),e.jsx(Re,{className:"bg-gradient-to-b from-blue-50/30 to-indigo-50/30",children:e.jsxs(Te,{children:[e.jsxs(_e,{className:"text-blue-700 font-medium flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Staff Management"]}),e.jsx(Ee,{children:e.jsx(Ae,{children:as.map(l=>e.jsx(Fe,{children:e.jsx(Ie,{asChild:!0,isActive:s.pathname===l.url,className:"hover:bg-blue-100 data-[active=true]:bg-gradient-to-r data-[active=true]:from-blue-100 data-[active=true]:to-indigo-100 data-[active=true]:border-r-2 data-[active=true]:border-blue-500 data-[active=true]:text-blue-700",children:e.jsxs(oe,{to:l.url,className:"flex items-center space-x-3 text-gray-700 hover:text-blue-700 transition-colors",onClick:()=>a(l.url),"aria-current":s.pathname===l.url?"page":void 0,children:[e.jsx(l.icon,{className:"h-4 w-4"}),e.jsx("span",{children:l.title})]})})},l.title))})})]})}),e.jsxs(Pe,{className:"border-t border-blue-200 p-4 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(Ge,{className:"h-8 w-8",children:e.jsx(Be,{className:"bg-gradient-to-br from-blue-600 to-indigo-600 text-white text-sm",children:t!=null&&t.full_name?t.full_name.charAt(0):"ST"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)||"Staff Member"}),e.jsxs("p",{className:"text-xs text-blue-600 truncate",children:["Staff ID: ",(t==null?void 0:t.id)||"Unknown"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1 border-blue-300 text-blue-700 hover:bg-blue-50",children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"Settings"]}),e.jsx(p,{variant:"outline",size:"sm",className:"border-blue-300 text-blue-700 hover:bg-blue-50",onClick:x,children:e.jsx(We,{className:"h-4 w-4"})})]})]})]})}function Ts(){const{user:s}=A(),t=ae(),c=ce(),[a,x]=o.useState([]),[l,b]=o.useState(!0),[j,r]=o.useState(null),[m,d]=o.useState(!1),[R,w]=o.useState(""),[N,S]=o.useState(0),[y,M]=o.useState(0),[L,C]=o.useState(0),[F,i]=o.useState("A"),g=()=>t.pathname.includes("/staff/routes")?"routes":t.pathname.includes("/staff/collections")?"marketplace":t.pathname.includes("/staff/rewards")?"rewards":"dashboard",[v,D]=o.useState(g());o.useEffect(()=>{D(g())},[t.pathname]);const I=n=>{switch(D(n),n){case"routes":c("/staff/routes");break;case"marketplace":c("/staff/collections");break;case"rewards":c("/staff/rewards");break;default:c("/staff");break}};o.useEffect(()=>{(async()=>{if(s)try{b(!0);const f=await $.Collections.list(100,0,void 0,s.id);x(f.items)}catch(f){console.error("Error fetching collections:",f),f.message&&f.message.includes("401")?(r("Authentication failed. Please log in again."),window.location.href="/staff/login"):f.message&&f.message.includes("403")?r("Access denied. You do not have permission to view this data."):r("Failed to load collections. Please try again later.")}finally{b(!1)}})()},[s]);const P=async()=>{try{if(!s){r("User not authenticated");return}const n={farmer_id:R,staff_id:s.id,liters:N,gps_latitude:y,gps_longitude:L,quality_grade:F,validation_code:"VALID-"+Date.now()},f=await $.Collections.create(n);w(""),S(0),M(0),C(0),i("A"),d(!1);const G=await $.Collections.list(100,0,void 0,s.id);x(G.items)}catch(n){console.error("Error submitting collection:",n),r("Failed to submit collection. Please try again.")}};return s?e.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-emerald-50 via-white to-blue-50",children:[e.jsx(te,{targetId:"main-content",children:"Skip to main content"}),e.jsx(ls,{}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex justify-between items-center mb-6",role:"banner",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Welcome to DairyChain Pro Elite"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Your professional dairy management platform"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ts,{}),e.jsx(p,{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white","aria-label":"Elite Staff Member",children:"Elite Staff Member"})]})]}),e.jsxs("main",{id:"main-content",role:"main",children:[j&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",role:"alert",children:j}),e.jsxs(me,{value:v,onValueChange:I,className:"space-y-6",children:[e.jsxs(xe,{className:"grid grid-cols-4 w-full",children:[e.jsx(W,{value:"dashboard",children:"Dashboard"}),e.jsx(W,{value:"routes",children:"Routes"}),e.jsx(W,{value:"marketplace",children:"Collections"}),e.jsx(W,{value:"rewards",children:"Rewards"})]}),e.jsx(q,{value:"dashboard",children:e.jsx(ss,{})}),e.jsx(q,{value:"routes",children:e.jsx(Xe,{})}),e.jsx(q,{value:"marketplace",children:e.jsxs("section",{"aria-labelledby":"collections-heading",children:[e.jsx(k,{as:"h2",id:"collections-heading",children:"Collections Management"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"My Collections"}),e.jsx(p,{onClick:()=>d(!m),"aria-label":m?"Cancel collection recording":"Record new collection",children:m?"Cancel":"New Collection"})]}),m&&e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Record New Collection"}),e.jsxs("form",{onSubmit:n=>{n.preventDefault(),P()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"farmerId",className:"block text-sm font-medium mb-1",children:"Farmer ID"}),e.jsx(V,{id:"farmerId",type:"text",value:R,onChange:n=>w(n.target.value),placeholder:"Enter farmer ID","aria-describedby":"farmerId-help"}),e.jsx("p",{id:"farmerId-help",className:"text-sm text-gray-500 mt-1",children:"Unique identifier for the farmer"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"liters",className:"block text-sm font-medium mb-1",children:"Liters Collected"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{id:"liters",type:"number",value:N,onChange:n=>S(Number(n.target.value)),placeholder:"Enter liters",min:"0.1",step:"0.1","aria-describedby":"liters-help"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500",children:"L"})})]}),e.jsx("p",{id:"liters-help",className:"text-sm text-gray-500 mt-1",children:"Volume of milk collected in liters"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"latitude",className:"block text-sm font-medium mb-1",children:"Latitude"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{id:"latitude",type:"number",value:y,onChange:n=>M(Number(n.target.value)),placeholder:"Enter latitude",step:"0.0001","aria-describedby":"latitude-help"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(se,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"})})]}),e.jsx("p",{id:"latitude-help",className:"text-sm text-gray-500 mt-1",children:"GPS latitude coordinate"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"longitude",className:"block text-sm font-medium mb-1",children:"Longitude"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{id:"longitude",type:"number",value:L,onChange:n=>C(Number(n.target.value)),placeholder:"Enter longitude",step:"0.0001","aria-describedby":"longitude-help"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(se,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"})})]}),e.jsx("p",{id:"longitude-help",className:"text-sm text-gray-500 mt-1",children:"GPS longitude coordinate"})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"qualityGrade",className:"block text-sm font-medium mb-1",children:"Quality Grade"}),e.jsxs(Se,{value:F,onValueChange:i,children:[e.jsx(Ce,{id:"qualityGrade","aria-describedby":"qualityGrade-help",children:e.jsx(ke,{placeholder:"Select quality grade"})}),e.jsxs(Me,{children:[e.jsx(O,{value:"A",children:"Grade A"}),e.jsx(O,{value:"B",children:"Grade B"}),e.jsx(O,{value:"C",children:"Grade C"})]})]}),e.jsx("p",{id:"qualityGrade-help",className:"text-sm text-gray-500 mt-1",children:"Quality assessment of the milk"})]}),e.jsxs(p,{type:"submit",className:"w-full","aria-label":"Record collection",children:[e.jsx(He,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Record Collection"]})]})]}),l?e.jsxs("div",{className:"text-center py-4",role:"status",children:[e.jsx(k,{children:"Loading collections..."}),e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-600"})]}):e.jsx("div",{className:"space-y-4",children:a.length>0?a.map(n=>e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["Collection #",n.id.substring(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Farmer: ",n.farmer_name]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:[n.liters," liters"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Grade: ",n.quality_grade]})]})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:n.timestamp&&new Date(n.timestamp).toLocaleString()})]},n.id)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No collections found. Record your first collection above."})})]})]})}),e.jsx(q,{value:"rewards",children:e.jsxs("section",{"aria-labelledby":"rewards-heading",children:[e.jsx(k,{as:"h2",id:"rewards-heading",children:"Rewards and Incentives"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Current Balance"}),e.jsx("div",{className:"text-4xl font-bold text-green-600",children:"$2,450"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Available for withdrawal"}),e.jsx(p,{className:"w-full mt-4","aria-label":"Withdraw funds",children:"Withdraw Funds"})]}),e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Next Milestone"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"Elite Status"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Complete 5 more premium tasks"}),e.jsx("div",{className:"mt-4 h-2 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-full bg-purple-600 rounded-full",style:{width:"75%"}})})]}),e.jsxs(u,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Bonus Opportunities"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Weekend Premium"}),e.jsx("span",{className:"text-green-600",children:"+25%"})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Quick Response"}),e.jsx("span",{className:"text-green-600",children:"+15%"})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Quality Bonus"}),e.jsx("span",{className:"text-green-600",children:"+30%"})]})]})]})]})]})})]})]})]}),e.jsx(Ke,{})]})]}):e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600",role:"status",children:e.jsx(k,{children:"Loading staff portal..."})})})}export{Ts as default};
