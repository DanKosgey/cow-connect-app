import{u as H,r as o,j as e,M as v,U as O,L as b}from"./index-C6fZJ48e.js";import{B as p}from"./button-CjSaidot.js";import{I as n}from"./input-ZoKW3yZy.js";import{C,a as P,b as S,c as F,d as k}from"./card-D80GW863.js";import{L as d}from"./label-Cb1HMnpx.js";import{A as _,a as E}from"./alert-Civ_HrAB.js";import{a as K}from"./ApiService-bGFnA_mg.js";import{E as D}from"./eye-off-CwyNIguP.js";import{E as A}from"./eye-qORrMeX6.js";import{L as R}from"./loader-circle-tNDcm6lY.js";import{P as $}from"./phone-dekQ5OlX.js";import{M as J}from"./map-pin-B94T8gzc.js";import{F as V}from"./file-text-BWfQSXbE.js";function de(){H();const[s,q]=o.useState({username:"",email:"",password:"",full_name:"",phone:"",address:"",national_id:""}),[w,L]=o.useState(""),[h,t]=o.useState(""),[g,T]=o.useState(!1),[j,U]=o.useState(!1),[u,y]=o.useState(!1),[i,N]=o.useState(1),[z,I]=o.useState(null),m=l=>{q(a=>({...a,[l.target.name]:l.target.value}))},Y=async l=>{var a,r,f,x;if(l.preventDefault(),t(""),s.password!==w){t("Passwords do not match");return}if(s.password.length<6){t("Password must be at least 6 characters long");return}y(!0);try{const c={username:s.username,email:s.email,password:s.password,full_name:s.full_name},M=await K.Auth.register(c);I(M),N(2)}catch(c){console.error("Registration error:",c),((a=c.response)==null?void 0:a.status)===400?t("Username or email already exists. Please choose a different one."):((r=c.response)==null?void 0:r.status)===500?t("Server error. Please try again later."):t(((x=(f=c.response)==null?void 0:f.data)==null?void 0:x.detail)||c.message||"Registration failed. Please try again.")}finally{y(!1)}},B=async l=>{l.preventDefault(),t("");try{const a={name:s.full_name,phone:s.phone,email:s.email,national_id:s.national_id,address:s.address,location_coordinates:{latitude:0,longitude:0}};console.log("ðŸšœ Creating farmer with data:",a);const r=await fetch("/api/v1/farmers/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const x=await r.json();throw new Error(`HTTP ${r.status}: ${x.detail||x.message||"Unknown error"}`)}const f=await r.json();console.log("âœ… Farmer created successfully:",f),N(3)}catch(a){console.error("âŒ Farmer profile creation error:",a);let r="Failed to create farmer profile. ";a.message.includes("405")?r+="The registration endpoint may not be properly configured. Please contact support.":a.message.includes("404")?r+="Registration endpoint not found. Please contact support.":a.message.includes("401")||a.message.includes("403")?r+="Authentication required. Please log in again or contact an administrator to create your farmer profile.":a.message.includes("422")?r+="Please check your input data and try again.":a.message.includes("Network error")?r+="Please check your internet connection and try again.":r+="Please try again or contact support if the problem persists.",t(r)}};return i===3?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-emerald-50 to-teal-50 p-4",children:e.jsxs(C,{className:"w-full max-w-2xl shadow-xl border-0 bg-white/80 backdrop-blur-sm",children:[e.jsxs(P,{className:"space-y-4 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-emerald-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(v,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx(S,{className:"text-2xl font-bold text-emerald-700",children:"Registration Complete"}),e.jsx(F,{className:"text-emerald-600",children:"Your account has been created successfully"})]})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(O,{className:"h-8 w-8 text-emerald-600"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-emerald-800",children:"Registration Successful!"}),e.jsx("p",{className:"text-emerald-600",children:"Your account has been created. You can now proceed to login and complete your KYC verification."})]}),e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-medium text-emerald-900 mb-2",children:"Next Steps:"}),e.jsxs("ul",{className:"text-sm text-emerald-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Verify your email address (check your inbox)"}),e.jsx("li",{children:"â€¢ Complete your KYC verification"}),e.jsx("li",{children:"â€¢ Start delivering milk"})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 pt-4",children:e.jsx(b,{to:"/login",className:"flex-1",children:e.jsx(p,{className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg",children:"Continue to Login"})})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(b,{to:"/",className:"text-sm text-emerald-600 hover:text-emerald-700 underline",children:"Back to Homepage"})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-emerald-50 to-teal-50 p-4",children:e.jsxs(C,{className:"w-full max-w-2xl shadow-xl border-0 bg-white/80 backdrop-blur-sm",children:[e.jsxs(P,{className:"space-y-4 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-emerald-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(v,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsxs(S,{className:"text-2xl font-bold text-emerald-700",children:[i===1&&"Create Farmer Account",i===2&&"Farmer Information"]}),e.jsxs(F,{className:"text-emerald-600",children:[i===1&&"Create your account to get started",i===2&&"Provide your personal information"]})]})]}),e.jsxs(k,{children:[i===1&&e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[h&&e.jsx(_,{className:"border-red-200 bg-red-50",children:e.jsx(E,{className:"text-red-800",children:h})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"full_name",className:"text-emerald-700 font-medium",children:"Full Name"}),e.jsx(n,{id:"full_name",name:"full_name",type:"text",value:s.full_name,onChange:m,placeholder:"Enter your full name",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"username",className:"text-emerald-700 font-medium",children:"Username"}),e.jsx(n,{id:"username",name:"username",type:"text",value:s.username,onChange:m,placeholder:"Choose a username",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",className:"text-emerald-700 font-medium",children:"Email Address"}),e.jsx(n,{id:"email",name:"email",type:"email",value:s.email,onChange:m,placeholder:"Enter your email",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"password",className:"text-emerald-700 font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"password",name:"password",type:g?"text":"password",value:s.password,onChange:m,placeholder:"Create a password",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500 pr-10"}),e.jsx("button",{type:"button",onClick:()=>T(!g),className:"absolute right-3 top-1/2 -translate-y-1/2 text-emerald-600 hover:text-emerald-700",children:g?e.jsx(D,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",className:"text-emerald-700 font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"confirmPassword",name:"confirmPassword",type:j?"text":"password",value:w,onChange:l=>L(l.target.value),placeholder:"Confirm your password",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500 pr-10"}),e.jsx("button",{type:"button",onClick:()=>U(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-emerald-600 hover:text-emerald-700",children:j?e.jsx(D,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]})]}),e.jsxs(p,{type:"submit",disabled:u,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg",children:[u?e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}):"Create Account",u&&"Creating Account..."]})]}),i===2&&e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[h&&e.jsx(_,{className:"border-red-200 bg-red-50",children:e.jsx(E,{className:"text-red-800",children:h})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"phone",className:"text-emerald-700 font-medium flex items-center",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Phone Number"]}),e.jsx(n,{id:"phone",name:"phone",type:"tel",value:s.phone,onChange:m,placeholder:"+254 700 000 000",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"address",className:"text-emerald-700 font-medium flex items-center",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Physical Address"]}),e.jsx(n,{id:"address",name:"address",type:"text",value:s.address,onChange:m,placeholder:"Your farm location",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"national_id",className:"text-emerald-700 font-medium flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"National ID Number"]}),e.jsx(n,{id:"national_id",name:"national_id",type:"text",value:s.national_id,onChange:m,placeholder:"Enter your ID number",required:!0,className:"border-emerald-200 focus:border-emerald-500 focus:ring-emerald-500"})]}),e.jsxs("div",{className:"flex space-x-4 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>N(1),className:"flex-1 border-emerald-300 text-emerald-700 hover:bg-emerald-50",children:"Back"}),e.jsxs(p,{type:"submit",disabled:u,className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg",children:[u?e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}):"Complete Registration",u&&"Saving..."]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(b,{to:"/",className:"text-sm text-emerald-600 hover:text-emerald-700 underline",children:"Back to Homepage"})})]})]})})}export{de as default};
