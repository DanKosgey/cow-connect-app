import{e as N,j as e,y as B,t as v,r as f,X as k,a as K,c as V,z as y}from"./index-C6fZJ48e.js";import{C as M,a as W,b as Z,c as G,d as J}from"./card-D80GW863.js";import{B as j}from"./button-CjSaidot.js";import{B as R}from"./badge-Bb0m1QXe.js";import{C as I}from"./clock-B7WW80Vs.js";import{C as Q}from"./circle-alert-B7BDXU-i.js";import{F as A}from"./file-check-BI3gUsdi.js";import{C as ee}from"./check-wjAQzcvr.js";import{I as D}from"./input-ZoKW3yZy.js";import{L as C}from"./label-Cb1HMnpx.js";import{F as te}from"./file-BX1SGBuZ.js";import{R as se,T as ae,P as re,C as L,a as ne,b as P,O as z,D as q}from"./index-CrhFojRB.js";import{M as ie}from"./map-pin-B94T8gzc.js";import{D as le}from"./dollar-sign-ZMqYMnDH.js";import{t as x,c as ce,g as oe,e as de,a as U,d as E,f as w}from"./en-US-wfBU2YNu.js";import{C as ue}from"./circle-x-rQriW1OR.js";import{T as me}from"./textarea-CnB4NpWf.js";import{T as fe,a as he,b,c as xe}from"./tabs-BM6-MBQ3.js";import"./Combination-D2BFsl2-.js";import"./index-7U90ZyfE.js";import"./index-Bmq6tP-i.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=N("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=N("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=N("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=N("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=N("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);function T(t,a){const s=x(t),i=x(a),r=s.getTime()-i.getTime();return r<0?-1:r>0?1:r}function ye(t){return ce(t,Date.now())}function be(t,a){const s=x(t),i=x(a),r=s.getFullYear()-i.getFullYear(),l=s.getMonth()-i.getMonth();return r*12+l}function Ne(t){return a=>{const i=(t?Math[t]:Math.trunc)(a);return i===0?0:i}}function we(t,a){return+x(t)-+x(a)}function De(t){const a=x(t);return a.setHours(23,59,59,999),a}function Te(t){const a=x(t),s=a.getMonth();return a.setFullYear(a.getFullYear(),s+1,0),a.setHours(23,59,59,999),a}function Me(t){const a=x(t);return+De(a)==+Te(a)}function Se(t,a){const s=x(t),i=x(a),r=T(s,i),l=Math.abs(be(s,i));let c;if(l<1)c=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-r*l);let n=T(s,i)===-r;Me(x(t))&&l===1&&T(t,i)===1&&(n=!1),c=r*(l-Number(n))}return c===0?0:c}function Ce(t,a,s){const i=we(t,a)/1e3;return Ne(s==null?void 0:s.roundingMethod)(i)}function Fe(t,a,s){const i=oe(),r=(s==null?void 0:s.locale)??i.locale??de,l=2520,c=T(t,a);if(isNaN(c))throw new RangeError("Invalid time value");const n=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:c});let d,g;c>0?(d=x(a),g=x(t)):(d=x(t),g=x(a));const m=Ce(g,d),u=(U(g)-U(d))/1e3,o=Math.round((m-u)/60);let h;if(o<2)return s!=null&&s.includeSeconds?m<5?r.formatDistance("lessThanXSeconds",5,n):m<10?r.formatDistance("lessThanXSeconds",10,n):m<20?r.formatDistance("lessThanXSeconds",20,n):m<40?r.formatDistance("halfAMinute",0,n):m<60?r.formatDistance("lessThanXMinutes",1,n):r.formatDistance("xMinutes",1,n):o===0?r.formatDistance("lessThanXMinutes",1,n):r.formatDistance("xMinutes",o,n);if(o<45)return r.formatDistance("xMinutes",o,n);if(o<90)return r.formatDistance("aboutXHours",1,n);if(o<E){const p=Math.round(o/60);return r.formatDistance("aboutXHours",p,n)}else{if(o<l)return r.formatDistance("xDays",1,n);if(o<w){const p=Math.round(o/E);return r.formatDistance("xDays",p,n)}else if(o<w*2)return h=Math.round(o/w),r.formatDistance("aboutXMonths",h,n)}if(h=Se(g,d),h<12){const p=Math.round(o/w);return r.formatDistance("xMonths",p,n)}else{const p=h%12,S=Math.trunc(h/12);return p<3?r.formatDistance("aboutXYears",S,n):p<9?r.formatDistance("overXYears",S,n):r.formatDistance("almostXYears",S+1,n)}}function _(t,a){return Fe(t,ye(t),a)}const F=[{status:"pending",label:"Pending Approval",icon:I},{status:"approved",label:"Approved",icon:ve},{status:"in_progress",label:"In Progress",icon:Q},{status:"evidence_submitted",label:"Evidence Submitted",icon:A},{status:"completed",label:"Completed",icon:ee}];function Re({currentStatus:t}){const a=F.findIndex(s=>s.status===t);return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex items-center justify-between",children:F.map((s,i)=>{const r=s.icon,l=i<=a,c=s.status===t;return e.jsxs(B.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:v("w-10 h-10 rounded-full flex items-center justify-center transition-colors",l?"bg-green-600 text-white":"bg-gray-200 text-gray-400",c&&"ring-4 ring-green-100"),children:e.jsx(r,{className:"w-5 h-5"})}),e.jsx("span",{className:v("mt-2 text-xs text-center max-w-[80px]",l?"text-green-600 font-medium":"text-gray-400"),children:s.label})]}),i<F.length-1&&e.jsx("div",{className:v("flex-1 h-0.5 transition-colors",i<a?"bg-green-600":"bg-gray-200")})]},s.status)})})})}function Ue({onUpload:t}){const[a,s]=f.useState([]),[i,r]=f.useState(!1),[l,c]=f.useState([]),n=m=>{if(m.target.files){const u=Array.from(m.target.files);s(o=>[...o,...u]),u.forEach(o=>{if(o.type.startsWith("image/")){const h=new FileReader;h.onloadend=()=>{c(p=>[...p,h.result])},h.readAsDataURL(o)}})}},d=async()=>{if(a.length!==0){r(!0);try{await t(a),s([]),c([])}catch(m){console.error("Upload failed:",m)}finally{r(!1)}}},g=m=>{s(u=>u.filter((o,h)=>h!==m)),c(u=>u.filter((o,h)=>h!==m))};return e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{children:"Upload Evidence"}),a.length>0&&e.jsx(j,{variant:"outline",size:"sm",onClick:()=>{s([]),c([])},children:"Clear All"})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(pe,{className:"h-8 w-8 text-gray-400"}),e.jsxs("div",{className:"text-center",children:[e.jsxs(C,{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-primary hover:text-primary/80",children:[e.jsx("span",{children:"Click to upload"}),e.jsx(D,{id:"file-upload",type:"file",className:"sr-only",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:n})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Images, PDFs, or Documents up to 10MB each"})]})]})}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Selected Files"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:a.map((m,u)=>e.jsxs("div",{className:"relative group border rounded-lg p-2",children:[e.jsx("button",{onClick:()=>g(u),className:"absolute -right-2 -top-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{className:"h-4 w-4"})}),m.type.startsWith("image/")?e.jsx("div",{className:"relative aspect-square",children:e.jsx("img",{src:l[u],alt:m.name,className:"absolute inset-0 w-full h-full object-cover rounded",loading:"lazy"})}):e.jsx("div",{className:"flex items-center justify-center aspect-square bg-gray-100 rounded",children:m.name.endsWith(".pdf")?e.jsx(te,{className:"h-8 w-8 text-red-500"}):e.jsx(O,{className:"h-8 w-8 text-blue-500"})}),e.jsx("p",{className:"mt-1 text-xs truncate",children:m.name})]},u))}),e.jsx(j,{onClick:d,disabled:i,className:"w-full mt-4",children:i?"Uploading...":"Upload Files"})]})]})})}function Ee(t=!0,a){const s=f.useRef(null);return f.useEffect(()=>{if(!t||!s.current)return;const i=s.current,r=i.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),l=r[0],c=r[r.length-1];l==null||l.focus();const n=d=>{d.key,d.key==="Tab"&&(d.shiftKey?document.activeElement===l&&(d.preventDefault(),c==null||c.focus()):document.activeElement===c&&(d.preventDefault(),l==null||l.focus()))};return i.addEventListener("keydown",n),()=>{i.removeEventListener("keydown",n)}},[t,a]),s}function _e(){const t=f.useRef(null);return{saveTriggerElement:()=>{t.current=document.activeElement},returnFocus:()=>{t.current&&document.contains(t.current)&&t.current.focus()},triggerRef:t}}const ke=se,Ie=ae,Le=re,X=f.forwardRef(({className:t,...a},s)=>e.jsx(z,{ref:s,className:v("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a}));X.displayName=z.displayName;const H=f.forwardRef(({className:t,children:a,...s},i)=>{const r=Ee(!0),{saveTriggerElement:l,returnFocus:c}=_e();return f.useEffect(()=>(l(),()=>{c()}),[]),e.jsxs(Le,{children:[e.jsx(X,{}),e.jsxs(L,{ref:n=>{typeof i=="function"?i(n):i&&(i.current=n),n&&(r.current=n)},className:v("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[a,e.jsxs(ne,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})});H.displayName=L.displayName;const Y=({className:t,...a})=>e.jsx("div",{className:v("flex flex-col space-y-1.5 text-center sm:text-left",t),...a});Y.displayName="DialogHeader";const $=f.forwardRef(({className:t,...a},s)=>e.jsx(P,{ref:s,className:v("text-lg font-semibold leading-none tracking-tight",t),...a}));$.displayName=P.displayName;const Pe=f.forwardRef(({className:t,...a},s)=>e.jsx(q,{ref:s,className:v("text-sm text-muted-foreground",t),...a}));Pe.displayName=q.displayName;const ze={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",in_progress:"bg-purple-100 text-purple-800",evidence_submitted:"bg-indigo-100 text-indigo-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"},qe={low:"bg-gray-100 text-gray-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-red-100 text-red-800"};function Oe({task:t,userRole:a,onActionClick:s}){const[i,r]=f.useState(!1),l=async n=>{const d=n.map(g=>URL.createObjectURL(g));s==null||s("submit",{...t,evidenceUrls:[...t.evidenceUrls,...d]}),r(!1)},c=()=>{if(a==="admin")switch(t.status){case"pending":return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"default",size:"sm",onClick:()=>s==null?void 0:s("approve",t),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"Approve & Fund"]}),e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>s==null?void 0:s("reject",t),children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"Reject"]})]});case"approved":return e.jsx(j,{variant:"default",size:"sm",onClick:()=>s==null?void 0:s("start",t),className:"bg-purple-600 hover:bg-purple-700 text-white",children:"Start Task"});case"evidence_submitted":return e.jsx(j,{variant:"default",size:"sm",onClick:()=>s==null?void 0:s("complete",t),className:"bg-green-600 hover:bg-green-700 text-white",children:"Complete & Pay"});default:return null}else if(a==="staff"&&t.status==="in_progress")return e.jsxs(ke,{open:i,onOpenChange:r,children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(j,{variant:"default",size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Submit Evidence"]})}),e.jsxs(H,{children:[e.jsx(Y,{children:e.jsx($,{children:"Upload Task Evidence"})}),e.jsx(Ue,{onUpload:l})]})]});return null};return e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:t.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(R,{className:ze[t.status],children:t.status.replace("_"," ").toUpperCase()}),t.priority&&e.jsx(R,{className:qe[t.priority],children:t.priority.toUpperCase()})]})]}),e.jsx(Re,{currentStatus:t.status}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),t.location]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Ksh ",t.budget.toLocaleString()]}),t.deadline&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Due: ",_(new Date(t.deadline),{addSuffix:!0})]}),t.comments&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),t.comments.length," comments"]})]}),t.evidenceUrls.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Evidence"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:t.evidenceUrls.map((n,d)=>e.jsx("img",{src:n,alt:`Evidence ${d+1}`,className:"h-20 w-20 object-cover rounded-lg",loading:"lazy"},d))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Created ",_(new Date(t.createdAt),{addSuffix:!0})]}),c()]})]})})}function Xe({onSubmit:t,isLoading:a=!1}){const[s,i]=f.useState({title:"",description:"",location:"",budget:0}),r=c=>{c.preventDefault(),t(s)},l=c=>{const{name:n,value:d}=c.target;i(g=>({...g,[n]:n==="budget"?parseFloat(d)||0:d}))};return e.jsxs(M,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Create New Task Request"}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsx("div",{children:e.jsx(D,{name:"title",placeholder:"Task Title",value:s.title,onChange:l,required:!0})}),e.jsx("div",{children:e.jsx(me,{name:"description",placeholder:"Describe what needs to be done...",value:s.description,onChange:l,required:!0,className:"min-h-[100px]"})}),e.jsx("div",{children:e.jsx(D,{name:"location",placeholder:"Location",value:s.location,onChange:l,required:!0})}),e.jsx("div",{children:e.jsx(D,{name:"budget",type:"number",min:"0",step:"0.01",placeholder:"Budget Amount",value:s.budget||"",onChange:l,required:!0})}),e.jsx(j,{type:"submit",className:"w-full",disabled:a,children:a?"Submitting...":"Submit Task Request"})]})]})}function ot(){const{user:t}=K(),[a]=f.useState(()=>t!=null&&t.is_admin?"admin":"staff"),[s,i]=f.useState("pending"),[r,l]=f.useState([]),[c,n]=f.useState(!1),{toast:d}=V();f.useEffect(()=>{(async()=>{n(!0);try{y.info(`Fetching tasks for user role: ${a}, status: ${s}`),await new Promise(o=>setTimeout(o,500)),l([])}catch(o){y.error("Error fetching tasks:",o),d({title:"Error",description:"Failed to fetch tasks. Please try again.",variant:"destructive"})}finally{n(!1)}})()},[a,s,d]);const g=async(u,o)=>{try{y.info(`Performing action ${u} on task ${o.id}`),d({title:"Success",description:`Task ${u} successfully.`})}catch(h){y.error(`Error performing action ${u} on task:`,h),d({title:"Error",description:`Failed to ${u} task. Please try again.`,variant:"destructive"})}},m=async u=>{try{y.info("Creating new task:",u),d({title:"Success",description:"Task created successfully."})}catch(o){y.error("Error creating task:",o),d({title:"Error",description:"Failed to create task. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Task Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage and track your dairy farm tasks"})]}),e.jsx(Xe,{onSubmit:m})]}),e.jsxs(fe,{value:s,onValueChange:u=>i(u),children:[e.jsxs(he,{children:[e.jsx(b,{value:"pending",children:"Pending"}),e.jsx(b,{value:"approved",children:"Approved"}),e.jsx(b,{value:"in_progress",children:"In Progress"}),e.jsx(b,{value:"evidence_submitted",children:"Evidence Submitted"}),e.jsx(b,{value:"completed",children:"Completed"}),e.jsx(b,{value:"rejected",children:"Rejected"})]}),e.jsx(xe,{value:s,className:"mt-6",children:e.jsxs(M,{children:[e.jsxs(W,{children:[e.jsxs(Z,{children:[s.replace("_"," ").toUpperCase()," Tasks"]}),e.jsxs(G,{children:["Manage your ",s.replace("_"," ")," tasks"]})]}),e.jsx(J,{children:c?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:"No tasks found"}),e.jsx(j,{onClick:()=>i("pending"),variant:"outline",className:"mt-4",children:"View Pending Tasks"})]}):e.jsx("div",{className:"space-y-6",children:r.map(u=>e.jsx(Oe,{task:u,userRole:a,onActionClick:g},u.id))})})]})})]})]})}export{ot as default};
